# komo-api アーキテクチャ設計

このドキュメントでは、komo-api パッケージ固有のディレクトリ構成と拡張ポイントについて説明します。

システム全体のアーキテクチャについては、[プロジェクトドキュメント](/docs)を参照してください。

## ディレクトリ構成

```
src/
├── db/          # データベース層
├── services/    # ビジネスロジック層
├── routes/      # ルーティング層
├── middleware/  # ミドルウェア層
├── utils/       # ユーティリティ層
├── types/       # 型定義
└── shared/      # 共通定義
```

## 各層の責務

各層の詳細な責務や実装については、実際のコードを参照してください。主要な層の概要：

- **データベース層** (`src/db/`): SQLite 接続、スキーマ定義
- **サービス層** (`src/services/`): ビジネスロジック（認証、サーバー管理、ハートビート、Wake-on-LAN）
- **ルーティング層** (`src/routes/`): API エンドポイント定義
- **ミドルウェア層** (`src/middleware/`): 認証、エラーハンドリング
- **ユーティリティ層** (`src/utils/`): ログ、暗号化、環境変数管理
- **共通層** (`src/shared/`): 共有型定義・定数

データフローやセキュリティ設計の詳細については、[プロジェクトドキュメント](/docs)を参照してください。

## 拡張ポイント

### 新しい API エンドポイントの追加

1. `services/` にビジネスロジックを実装
2. `routes/` に新しいルートファイルを作成
3. `server.ts` でルートを登録

### 新しいサービスの追加

1. `services/` に新しいサービスファイルを作成
2. 必要に応じて `routes/` で API を公開
3. `db/schema.ts` でテーブル定義を追加（必要に応じて）

## 今後の課題

- データベースマイグレーション機能の追加
- ハートビート監視の起動処理追加
- エラーハンドリングの強化
- テスト追加（ユニット・統合・E2E）
- ヘルスチェックエンドポイントの追加
- Docker/Podman コンテナ化

## 関連ドキュメント

- [PRD](/docs/prd.md): プロダクト要求定義
- [SRS](/docs/srs.md): ソフトウェア要件定義
- [SDD](/docs/sdd.md): システム設計ドキュメント
- [パッケージ README](./README.md): 開発者向けドキュメント
